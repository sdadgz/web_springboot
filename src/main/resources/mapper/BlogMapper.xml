<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.sdadgz.web_springboot.mapper.BlogMapper">

    <!--  根据name和title获取blog  -->
    <select id="getBlog" resultMap="BlogMap">
        select *,
               b.id         bid,
               b.createtime bct,
               b.user_id    buid,
               i.id         iid,
               i.createtime ict,
               i.user_id    iuid,
               u.id         uid,
               u.createtime uct
        from blog b
                 left join img i on b.img_id = i.id
                 left join user u on b.user_id = u.id
        where u.name = #{username}
          and b.title = #{title}
    </select>

    <!--  根据id获取用户blogs  -->
    <select id="getBlogsByName" resultMap="BlogMap">
        select *,
               b.id         bid,
               b.createtime bct,
               b.user_id    buid,
               i.id         iid,
               i.createtime ict,
               i.user_id    iuid,
               u.id         uid,
               u.createtime uct
        from blog b
                 left join img i on b.img_id = i.id
                 left join user u on b.user_id = u.id
        where u.name = #{username}
    </select>

    <!--  返回map  -->
    <resultMap id="BlogMap" type="Blog">
        <result property="id" column="bid"/>
        <result property="createtime" column="bct"/>
        <result property="userId" column="buid"/>

        <result property="text" column="text"/>
        <result property="imgId" column="img_id"/>
        <result property="title" column="title"/>
        <result property="detail" column="detail"/>

        <association property="img" javaType="Img">
            <result property="id" column="iid"/>
            <result property="createtime" column="ict"/>
            <result property="userId" column="iuid"/>

            <result property="url" column="url"/>
            <result property="md5" column="md5"/>
            <result property="isDelete" column="is_delete"/>
            <result property="field" column="field"/>
        </association>

        <association property="user" javaType="User">
            <result property="id" column="uid"/>
            <result property="createtime" column="uct"/>

            <result property="name" column="name"/>
            <!--      密码不写      -->
            <result property="avatar" column="avatar"/>
        </association>

    </resultMap>
</mapper>
